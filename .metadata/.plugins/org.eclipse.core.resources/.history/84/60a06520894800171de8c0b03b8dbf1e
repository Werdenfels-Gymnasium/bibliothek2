package datenbank;

import java.sql.*;

public class SQLite {
	
	private static Connection con;
	private static boolean hasData = false;
	
	public void getConnection() throws ClassNotFoundException, SQLException {
		Class.forName("org.sqlite.JDBC");
		con = DriverManager.getConnection("jdbc:sqlite:SQLiteBibliothek.db");
		initialise();
	}

	public void initialise() throws SQLException, ClassNotFoundException {
		if (!hasData) {
			hasData = true;
			initialiseBuch();
			initialiseEinzelperson();
			initialiseAusleihe();
			initialiseEntleiher();
			initialiseUnterMittelstufenschüler();
			initialiseEntleiherstandort();
			initialiseOberstufenschüler();
			
			}
		}
	
	
	private void initialiseBuch() throws SQLException {
		Statement state = con.createStatement();
		ResultSet res = state.executeQuery("SELECT name FROM sqlite_master WHERE type='table' AND name = 'buch';");
		
		if (!res.next()) {
			//Tabelle nicht vorhanden --> Muss erstellt werden.
			Statement state2 = con.createStatement();
			//int Zweig
			//0 beide
			//1 NW
			//2 SG
			state2.executeQuery("CREATE TABLE 'buch' ('titel' 'VARCHAR (60)', 'kurztitel' 'VARCHAR (20)', 'fach ' 'VARCHAR (60)', 'jahrgangsstufe' INTEGER, 'iSBN' INTEGER PRIMARY KEY, 'zweig' INTEGER);");
			}
	}
	
	private void initialiseAusleihe() throws SQLException {
		Statement state = con.createStatement();
		ResultSet res = state.executeQuery("SELECT name FROM sqlite_master WHERE type='table' AND name = 'ausleihe';");
		
		if (!res.next()) {
			//Tabelle nicht vorhanden --> Muss erstellt werden
			Statement state2 = con.createStatement();
			state2.executeQuery("CREATE TABLE 'ausleihe' ('idAusleihe' INTEGER, 'iSBN' INTEGER, 'idEntleiher' INTEGER, 'abgabedatum' DATETIME, PRIMARY KEY ('iSBN', 'idEntleiher'));");
			//ISBN und IDentleiher als Fremdschlüssel
		}
	}
	
	private void initialiseEntleiher() throws SQLException {

		Statement state = con.createStatement();
		ResultSet res = state.executeQuery("SELECT name FROM sqlite_master WHERE type='table' AND name = 'entleiher';");
		
		if (!res.next()) {
			//Tabelle nicht vorhanden --> Muss erstellt werden
			Statement state2 = con.createStatement();
			state2.executeQuery("CREATE TABLE 'entleiher' ('idEntleiher' INTEGER PRIMARY KEY AUTOINCREMENT UNIQUE, 'art' 'VARCHAR (20)');");
			}
	}
	
	private void initialiseEinzelperson() throws SQLException {
		Statement state = con.createStatement();
		ResultSet res = state.executeQuery("SELECT name FROM sqlite_master WHERE type='table' AND name = 'einzelperson';");
		
		if (!res.next()) {
			//Tabelle nicht vorhanden --> Muss erstellt werden
			Statement state2 = con.createStatement();
			state2.executeQuery("Create Table einzelperson (IDentleiher INTEGER PRIMARY KEY," + "nachname VARCHAR (20)," + "vorname VARCHAR (20)," + "adresse VARCHAR (80)," + "telefonnummer INTEGER);");
			}
	}
	
	private void initialiseUnterMittelstufenschüler() throws SQLException {
		Statement state = con.createStatement();
		ResultSet res = state.executeQuery("SELECT name FROM sqlite_master WHERE type='table' AND name = 'untermittelstufenschueler';");
		
		if (!res.next()) {
			//Tabelle nicht vorhanden --> Muss erstellt werden
			Statement state2 = con.createStatement();
			state2.executeQuery("CREATE TABLE 'untermittelstufenschueler' ('idEntleiher' INTEGER PRIMARY KEY UNIQUE, 'nachname' 'VARCHAR (60)', 'vorname' 'VARCHAR (60)', 'abiturjahrgang' INTEGER, 'klasse' 'VARCHAR (3)');");
			}
	}
	
	private void initialiseEntleiherstandort() throws SQLException {
		Statement state = con.createStatement();
		ResultSet res = state.executeQuery("SELECT name FROM sqlite_master WHERE type='table' AND name = 'entleiherStandort';");
		
		if (!res.next()) {
			//Tabelle nicht vorhanden --> Muss erstellt werden
			Statement state2 = con.createStatement();
			state2.executeQuery("CREATE TABLE 'entleiherStandort' ('idEntleiher' INTEGER PRIMARY KEY UNIQUE, 'standort' 'VARCHAR (200)');");
			}
	}

	private void initialiseOberstufenschüler() throws SQLException {
		Statement state = con.createStatement();
		ResultSet res = state.executeQuery("SELECT name FROM sqlite_master WHERE type='table' AND name = 'oberstufenschüler';");
		
		if (!res.next()) {
			//Tabelle nicht vorhanden --> Muss erstellt werden
			Statement state2 = con.createStatement();
			state2.executeQuery("CREATE TABLE 'oberstufenschueler' ('idEntleiher' INTEGER PRIMARY KEY UNIQUE, 'nachname' 'VARCHAR (60)', 'vorname' 'VARCHAR (60)', 'abiturjahrgang' INTEGER, 'idKurskombi' INTEGER);");
			}
	}
}
